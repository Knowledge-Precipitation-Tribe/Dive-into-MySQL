# 索引的设计原则

1. 适合索引的列是出现在where子句中的列，或者连接子句中指定的列，较频繁作为查询条件的字段才去创建索引，对于那些查询中很少涉及的列，重复值比较多的列不要建立索引。
2. 更新频繁字段不适合创建索引。
3. 定义有外键的数据列一定要建立索引。
4. 基数较小的类，索引效果较差，没有必要在此列建立索引。
5. 若是不能有效区分数据的列不适合做索引列\(如性别，男女未知，最多也就三种，区分度实在太低\)。
6. 使用短索引，如果对长字符串列进行索引，应该指定一个前缀长度，这样能够节省大量索引空间。
7. 尽量的扩展索引，不要新建索引。比如表中已经有a的索引，现在要加\(a,b\)的索引，那么只需要修改原来的索引即可。
8. 不要过度索引。索引需要额外的磁盘空间，并降低写操作的性能。在修改表内容的时候，索引会进行更新甚至重构，索引列越多，这个时间就会越长。所以只保持需要的索引有利于查询即可。
9. [最左前缀匹配原则](suo-yin-de-she-ji-yuan-ze.md#zui-zuo-qian-zhui-yuan-ze)是组合索引非常重要的原则，mysql会一直向右匹配直到遇到范围查询\(&gt;、&lt;、between、like\)就停止匹配，比如a = 1 and b = 2 and c &gt; 3 and d = 4 如果建立\(a,b,c,d\)顺序的索引，d是用不到索引的，如果建立\(a,b,d,c\)的索引则都可以用到，a,b,d的顺序可以任意调整。
10. 对于定义为text、image和bit的数据类型的列不要建立索引。
11. 应该指定列为NOT NULL，除非你想存储NULL。在mysql中，含有空值的列很难进行查询优化，因为它们使得索引、索引的统计信息以及比较运算更加复杂。你应该用0、一个特殊的值或者一个空串代替空值。
12. 取值离散大的字段（变量各个取值之间的差异程度）的列放到联合索引的前面，可以通过count\(\)函数查看字段的差异值，返回值越大说明字段的唯一值越多字段的离散程度高。
13. 索引字段越小越好，数据库的数据存储以页为单位一页存储的数据越多一次IO操作获取的数据越大效率越高。

## 最左前缀原则

MySQL可以使用多个字段同时建立一个索引，叫做联合索引。在联合索引中，如果想要命中索引，需要按照建立索引时的字段顺序挨个使用，否则无法命中索引。具体原因为:

MySQL使用索引时需要索引有序，假设现在建立了"name，age，school"的联合索引，那么索引的排序为: 先按照name排序，如果name相同，则按照age排序，如果age的值也相等，则按照school进行排序，也称为最左前缀原则。

当进行查询时，此时索引仅仅按照name严格有序，因此必须首先使用name字段进行等值查询，之后对于匹配到的列而言，其按照age字段严格有序，此时可以使用age字段用做索引查找，以此类推。因此在建立联合索引的时候应该注意索引列的顺序，一般情况下，将查询需求频繁或者字段选择性高的列放在前面。此外可以根据特例的查询或者表结构进行单独的调整。

在MySQL建立**联合索引**时会遵守最左前缀匹配原则，即最左优先，在检索数据时从联合索引的最左边开始匹配。

要想理解联合索引的最左匹配原则，先来理解下索引的底层原理。索引的底层是一颗B+树，那么联合索引的底层也就是一颗B+树，只不过联合索引的B+树节点中存储的是键值。由于构建一棵B+树只能根据一个值来确定索引关系，所以数据库依赖联合索引最左的字段来构建。

举例：创建一个（a,b）的联合索引，那么它的索引树就是下图的样子。

![](../../.gitbook/assets/image%20%28147%29.png)

可以看到a的值是有顺序的，1，1，2，2，3，3，而b的值是没有顺序的1，2，1，4，1，2。但是我们又可发现a在等值的情况下，b值又是按顺序排列的，但是这种顺序是相对的。这是因为MySQL创建联合索引的规则是首先会对联合索引的最左边第一个字段排序，在第一个字段的排序基础上，然后在对第二个字段进行排序。所以b=2这种查询条件没有办法利用索引。

## 总结

最左前缀原则, 即如果你创建一个联合索引, 那这个索引的任何前缀都会用于查询, \(col1, col2, col3\)这个联合索引的所有前缀 就是\(col1\), \(col1, col2\), \(col1, col2, col3\), 包含这些列的查询都会启用索 引查询。

其他所有不在最左前缀里的列都不会启用索引, 即使包含了联合索引里的部分列也不行. 即上述中的\(col2\), \(col3\), \(col2, col3\) 都不会启用索引去查询.

**注意, \(col1, col3\)会启用\(col1\)的索引查询**

